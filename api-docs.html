<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
    >
    <title>RouterCompanion APK Builder API</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #161b22;
            border-radius: 8px;
            border: 1px solid #30363d;
            padding: 24px;
        }

        h1 {
            color: #58a6ff;
            border-bottom: 1px solid #30363d;
            padding-bottom: 10px;
        }

        .endpoint {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .method {
            background: #238636;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .url {
            font-family: monospace;
            color: #f85149;
            margin: 8px 0;
        }

        pre {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            overflow-x: auto;
            color: #e6edf3;
        }

        .response {
            margin-top: 12px;
        }

        .success {
            color: #3fb950;
        }

        .error {
            color: #f85149;
        }

        .info {
            color: #58a6ff;
        }

        .quick-build {
            background: #21262d;
            border: 1px solid #f85149;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .build-form input,
        .build-form button {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            color: #c9d1d9;
        }

        .build-form button {
            background: #238636;
            cursor: pointer;
        }

        .build-form button:hover {
            background: #2ea043;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸš€ RouterCompanion APK Builder API</h1>

        <div class="info">
            <p>è¿™æ˜¯ä¸€ä¸ªç”¨äºæ„å»º RouterCompanion APK çš„ API æ¥å£æ–‡æ¡£å’Œæµ‹è¯•å·¥å…·ã€‚</p>
        </div>

        <div class="endpoint">
            <h3><span class="method">POST</span> GitHub Repository Dispatch</h3>
            <div class="url">https://api.github.com/repos/{owner}/{repo}/dispatches</div>

            <h4>è¯·æ±‚å¤´:</h4>
            <pre>Authorization: token {github_token}
Accept: application/vnd.github.v3+json
Content-Type: application/json</pre>

            <h4>è¯·æ±‚ä½“:</h4>
            <pre>{
  "event_type": "build-with-domain",
  "client_payload": {
    "domain": "https://your-domain.com/login"
  }
}</pre>

            <div class="response">
                <h4>å“åº”:</h4>
                <div class="success">âœ… æˆåŠŸ (204 No Content)</div>
                <div class="error">âŒ å¤±è´¥ (401/403/404)</div>
            </div>
        </div>

        <div class="quick-build">
            <h3>ğŸ”§ å¿«é€Ÿæ„å»ºæµ‹è¯•</h3>
            <p>åœ¨è¿™é‡Œæµ‹è¯• API è°ƒç”¨ï¼š</p>

            <div class="build-form">
                <input
                    type="text"
                    id="owner"
                    placeholder="GitHub ç”¨æˆ·å (ä¾‹å¦‚: xieleihan)"
                    value="xieleihan"
                >
                <input
                    type="text"
                    id="repo"
                    placeholder="ä»“åº“å (ä¾‹å¦‚: RouterCompanion)"
                    value="RouterCompanion"
                >
                <input
                    type="url"
                    id="domain"
                    placeholder="ç›®æ ‡åŸŸå (ä¾‹å¦‚: https://example.com/login)"
                    value="http://game.localtest.echoing.cc:61007/login"
                >
                <input
                    type="password"
                    id="token"
                    placeholder="GitHub Personal Access Token"
                >
                <button onclick="triggerBuild()">ğŸš€ è§¦å‘æ„å»º</button>
            </div>

            <pre
                id="result"
                style="display: none;"
            ></pre>
        </div>

        <div class="endpoint">
            <h3>ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹</h3>

            <h4>cURL ç¤ºä¾‹:</h4>
            <pre>curl -X POST \
  -H "Authorization: token ghp_xxxxxxxxxxxx" \
  -H "Accept: application/vnd.github.v3+json" \
  -H "Content-Type: application/json" \
  -d '{
    "event_type": "build-with-domain",
    "client_payload": {
      "domain": "https://example.com/login"
    }
  }' \
  https://api.github.com/repos/xieleihan/RouterCompanion/dispatches</pre>

            <h4>JavaScript ç¤ºä¾‹:</h4>
            <pre>fetch('https://api.github.com/repos/xieleihan/RouterCompanion/dispatches', {
  method: 'POST',
  headers: {
    'Authorization': 'token ghp_xxxxxxxxxxxx',
    'Accept': 'application/vnd.github.v3+json',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    event_type: 'build-with-domain',
    client_payload: {
      domain: 'https://example.com/login'
    }
  })
}).then(response => {
  if (response.ok) {
    console.log('æ„å»ºè§¦å‘æˆåŠŸ!');
  }
});</pre>

            <h4>Python ç¤ºä¾‹:</h4>
            <pre>import requests

response = requests.post(
    'https://api.github.com/repos/xieleihan/RouterCompanion/dispatches',
    headers={
        'Authorization': 'token ghp_xxxxxxxxxxxx',
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
    },
    json={
        'event_type': 'build-with-domain',
        'client_payload': {
            'domain': 'https://example.com/login'
        }
    }
)

if response.status_code == 204:
    print('æ„å»ºè§¦å‘æˆåŠŸ!')
else:
    print(f'é”™è¯¯: {response.status_code}')</pre>
        </div>

        <div class="endpoint">
            <h3>ğŸ”— ç›¸å…³é“¾æ¥</h3>
            <ul>
                <li><a
                        href="https://github.com/xieleihan/RouterCompanion/actions"
                        target="_blank"
                    >ğŸ”„ æŸ¥çœ‹æ„å»ºçŠ¶æ€</a></li>
                <li><a
                        href="https://github.com/xieleihan/RouterCompanion/releases"
                        target="_blank"
                    >ğŸ“¦ ä¸‹è½½ APK</a></li>
                <li><a
                        href="https://github.com/settings/tokens"
                        target="_blank"
                    >ğŸ”‘ åˆ›å»º GitHub Token</a></li>
            </ul>
        </div>

        <div class="info">
            <h3>ğŸ“ æ³¨æ„äº‹é¡¹</h3>
            <ul>
                <li>GitHub Token éœ€è¦å…·æœ‰ <code>repo</code> æƒé™</li>
                <li>æ„å»ºè¿‡ç¨‹å¤§çº¦éœ€è¦ 3-5 åˆ†é’Ÿ</li>
                <li>æ„å»ºå®Œæˆåä¼šè‡ªåŠ¨åˆ›å»º GitHub Release</li>
                <li>APK æ–‡ä»¶åæ ¼å¼ï¼š<code>apk-{æ—¥æœŸ}-{åŸŸå}-{å“ˆå¸Œ}-v{ç‰ˆæœ¬å·}</code></li>
            </ul>
        </div>
    </div>

    <script>
        async function triggerBuild() {
            const owner = document.getElementById('owner').value;
            const repo = document.getElementById('repo').value;
            const domain = document.getElementById('domain').value;
            const token = document.getElementById('token').value;
            const resultDiv = document.getElementById('result');

            if (!owner || !repo || !domain || !token) {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.textContent = 'â³ å‘é€æ„å»ºè¯·æ±‚...';
            resultDiv.className = '';

            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        event_type: 'build-with-domain',
                        client_payload: {
                            domain: domain
                        }
                    })
                });

                const timestamp = new Date().toLocaleString('zh-CN');

                if (response.status === 204) {
                    resultDiv.innerHTML = `âœ… æ„å»ºè¯·æ±‚å‘é€æˆåŠŸ! (${timestamp})

ğŸ“ ç›®æ ‡åŸŸå: ${domain}
ğŸ”— æ„å»ºçŠ¶æ€: https://github.com/${owner}/${repo}/actions
ğŸ“¦ å‘å¸ƒé¡µé¢: https://github.com/${owner}/${repo}/releases

â³ è¯·ç­‰å¾… 3-5 åˆ†é’ŸæŸ¥çœ‹æ„å»ºç»“æœ`;
                    resultDiv.style.color = '#3fb950';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `âŒ æ„å»ºè¯·æ±‚å¤±è´¥ (${timestamp})

HTTP ${response.status}: ${response.statusText}
${errorText}

ğŸ” å¯èƒ½åŸå› :
â€¢ GitHub Token æ— æ•ˆæˆ–æƒé™ä¸è¶³
â€¢ ä»“åº“åç§°é”™è¯¯
â€¢ ç½‘ç»œè¿æ¥é—®é¢˜`;
                    resultDiv.style.color = '#f85149';
                }

            } catch (error) {
                resultDiv.innerHTML = `âŒ è¯·æ±‚å¼‚å¸¸ (${new Date().toLocaleString('zh-CN')})

é”™è¯¯ä¿¡æ¯: ${error.message}

ğŸ” è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè¾“å…¥ä¿¡æ¯`;
                resultDiv.style.color = '#f85149';
            }
        }

        // è‡ªåŠ¨ä¿å­˜è¾“å…¥å†…å®¹åˆ° localStorage
        ['owner', 'repo', 'domain', 'token'].forEach(id => {
            const element = document.getElementById(id);
            // åŠ è½½ä¿å­˜çš„å€¼ï¼ˆé™¤äº†tokenï¼‰
            if (id !== 'token') {
                const saved = localStorage.getItem(`api_${id}`);
                if (saved) element.value = saved;
            }

            // ä¿å­˜è¾“å…¥å€¼
            element.addEventListener('input', () => {
                if (id !== 'token') {  // ä¸ä¿å­˜tokenåˆ°localStorage
                    localStorage.setItem(`api_${id}`, element.value);
                }
            });
        });
    </script>
</body>

</html>